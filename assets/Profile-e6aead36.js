import{_ as q,a0 as A,a1 as K,u as R,r as w,T,y as W,a as $,b as h,c as g,a2 as o,w as d,d as l,t as i,i as j,F as G,a3 as c,E as X,bW as Y,a4 as J,j as _,bX as L,ab as O,p as Q,k as Z,bY as ee}from"./index-c90bc775.js";import{E as se}from"./el-dialog-3c2435f3.js";/* empty css                   */import{E as le,a as ae}from"./el-form-item-091f8ed7.js";/* empty css                 */import{E as oe,a as te}from"./el-progress-f97ff985.js";import"./castArray-2def1d6a.js";import"./_initCloneObject-d01ac546.js";import"./isEqual-44e6bdeb.js";const f=m=>(Q("data-v-947409cf"),m=m(),Z(),m),re={class:"icon mr8","aria-hidden":"true",style:{"font-size":"12px"}},ie=f(()=>l("use",{"xlink:href":"#icon-Back"},null,-1)),de=[ie],ne={class:"main"},ue={class:"second-title"},pe={class:"flex-between top"},_e={class:"flex-center"},me={class:"avatar"},ce={class:"icon","aria-hidden":"true",style:{"font-size":"10px"}},fe=f(()=>l("use",{"xlink:href":"#icon-camera"},null,-1)),ve=[fe],we={style:{"margin-bottom":"14px"}},he={class:"top-right"},ge={style:{"margin-top":"12px"}},be={class:"content"},ye={class:"flex-between item"},Ve={class:"label"},Pe={class:"flex-between item"},ke={class:"label"},$e={class:"flex-between item"},Ee={class:"label"},Ue={class:"flex-between item"},xe={class:"label"},Me={class:"flex-between item"},Ie=f(()=>l("div",{class:"label"},"GITHUB",-1)),Se={class:"footer"},Be={class:"between"},Ce=f(()=>l("div",null,null,-1)),Fe={__name:"Profile",setup(m){const{t:u,locale:ze}=A(),b=K(),y=R(),E=()=>{window.history.length>1?y.back():y.push("/")},U=w("https://161.189.142.56/api/web/upload_image/"),x=e=>{if(e.type.startsWith("image/")){if(e.size/1024/1024>2)return c.error("Picture size can not exceed 2MB!"),!1}else return c.error("Please select a picture!"),!1;return!0},M=(e,a)=>{e.image_url&&(s.value.avatar=e.image_url,V())},s=w({});T(()=>b.state.userInfo,(e,a)=>{s.value.first_name=e.first_name,s.value.last_name=e.last_name,s.value.affiliation=e.affiliation,s.value.github_url=e.github_url||"",s.value.google_scholar_url=e.google_scholar_url||"",s.value.linkedin_url=e.linkedin_url||"",s.value.avatar=e.avatar,s.value.username=e.username,s.value.email=e.email},{immediate:!0,deep:!0});const I=W(()=>{let e=2;return s.value.first_name&&(e+=1),s.value.last_name&&(e+=1),s.value.affiliation&&(e+=1),s.value.github_url&&(e+=1),Math.round(100*e/6)}),V=()=>{b.dispatch("updateUser",{first_name:s.value.first_name,last_name:s.value.last_name,affiliation:s.value.affiliation,github_url:s.value.github_url,google_scholar_url:s.value.google_scholar_url,linkedin_url:s.value.linkedin_url,avatar:s.value.avatar}).then(e=>{c.success(u("user.profileUpdatedSuccess"))})},t=$({visible:!1,old_password:"",new_password1:"",new_password2:""}),S=()=>{t.visible=!0},P=w(),k=()=>{P.value.validate(e=>{e&&ee({old_password:t.old_password,new_password1:t.new_password1,new_password2:t.new_password2}).then(a=>{c.success(u("user.pwChangeSuccess")),t.visible=!1})})},B=(e,a,n)=>{a!==t.new_password1?n(new Error(u("user.confirmpwVerify1"))):n()},C=$({old_password:[{required:!0,message:u("user.oldPwVerify1"),trigger:"blur"},{pattern:/^.{8,}$/,message:u("user.oldPwVerify2"),trigger:"blur"}],new_password1:[{required:!0,message:u("user.newPwVerify1"),trigger:"blur"},{pattern:/^.{8,}$/,message:u("user.oldPwVerify2"),trigger:"blur"}],new_password2:[{validator:B,trigger:"blur"}]});return(e,a)=>{const n=X,F=Y,z=oe,N=te,p=J,v=le,D=ae,H=se;return h(),g(G,null,[o(n,{text:"",onClick:E},{default:d(()=>[(h(),g("svg",re,de)),_(" "+i(e.$t("back")),1)]),_:1}),l("div",ne,[l("div",ue,i(e.$t("user.profile")),1),l("div",pe,[l("div",_e,[l("div",me,[o(F,{size:64,src:s.value.avatar||j(L)},null,8,["src"]),o(z,{class:"avatar-uploader",name:"image",action:U.value,"show-file-list":!1,"on-success":M,"before-upload":x},{default:d(()=>[(h(),g("svg",ce,ve))]),_:1},8,["action"])]),l("div",null,[l("div",we,i(s.value.username),1),l("div",null,i(s.value.email),1)])]),l("div",he,[o(N,{type:"circle",percentage:I.value,width:65,"stroke-width":7,color:"#6D87F9"},null,8,["percentage"]),l("div",ge,i(e.$t("user.profileCompleted")),1)])]),l("div",be,[l("div",ye,[l("div",Ve,i(e.$t("user.password")),1),o(n,{plain:"",onClick:S},{default:d(()=>[_(i(e.$t("user.changePassword")),1)]),_:1})]),l("div",Pe,[l("div",ke,i(e.$t("user.firstName")),1),o(p,{modelValue:s.value.first_name,"onUpdate:modelValue":a[0]||(a[0]=r=>s.value.first_name=r),modelModifiers:{trim:!0},placeholder:"-",maxlength:"150"},null,8,["modelValue"])]),l("div",$e,[l("div",Ee,i(e.$t("user.lastName")),1),o(p,{modelValue:s.value.last_name,"onUpdate:modelValue":a[1]||(a[1]=r=>s.value.last_name=r),modelModifiers:{trim:!0},placeholder:"-",maxlength:"150"},null,8,["modelValue"])]),l("div",Ue,[l("div",xe,i(e.$t("user.affilliate")),1),o(p,{modelValue:s.value.affiliation,"onUpdate:modelValue":a[2]||(a[2]=r=>s.value.affiliation=r),modelModifiers:{trim:!0},placeholder:"-",maxlength:"512"},null,8,["modelValue"])]),l("div",Me,[Ie,o(p,{modelValue:s.value.github_url,"onUpdate:modelValue":a[3]||(a[3]=r=>s.value.github_url=r),modelModifiers:{trim:!0},placeholder:"-",maxlength:"200"},null,8,["modelValue"])])]),l("div",Se,[o(n,{type:"primary",onClick:V},{default:d(()=>[_(i(e.$t("save")),1)]),_:1})])]),o(H,{modelValue:t.visible,"onUpdate:modelValue":a[8]||(a[8]=r=>t.visible=r),title:e.$t("user.changePassword"),width:"500",class:"oa-dialog","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:d(()=>[l("div",Be,[Ce,l("div",null,[o(n,{onClick:a[7]||(a[7]=r=>t.visible=!1),text:"",bg:""},{default:d(()=>[_(i(e.$t("cancel")),1)]),_:1}),o(n,{type:"primary",onClick:k},{default:d(()=>[_(i(e.$t("submit")),1)]),_:1})])])]),default:d(()=>[o(D,{model:t,rules:C,ref_key:"passwordRef",ref:P,"label-position":"top","require-asterisk-position":"right"},{default:d(()=>[o(v,{label:e.$t("user.oldPassword"),prop:"old_password"},{default:d(()=>[o(p,{type:"password",modelValue:t.old_password,"onUpdate:modelValue":a[4]||(a[4]=r=>t.old_password=r),modelModifiers:{trim:!0},placeholder:e.$t("user.oldPasswordPH"),maxlength:"128","show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(v,{label:e.$t("user.newPassword"),prop:"new_password1"},{default:d(()=>[o(p,{type:"password",modelValue:t.new_password1,"onUpdate:modelValue":a[5]||(a[5]=r=>t.new_password1=r),modelModifiers:{trim:!0},placeholder:e.$t("user.newPasswordPH"),maxlength:"128","show-password":""},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),o(v,{label:e.$t("user.confirmpw"),prop:"new_password2"},{default:d(()=>[o(p,{type:"password",modelValue:t.new_password2,"onUpdate:modelValue":a[6]||(a[6]=r=>t.new_password2=r),modelModifiers:{trim:!0},placeholder:e.$t("user.confirmpwPH"),maxlength:"128","show-password":"",onKeypress:O(k,["enter"])},null,8,["modelValue","placeholder","onKeypress"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])],64)}}},je=q(Fe,[["__scopeId","data-v-947409cf"]]);export{je as default};
